<!DOCTYPE html>
<html>
<head>
  <title>Icebreaker</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/5/w3.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <style>
    body,h1,h2,h3,h4,h5,h6 {font-family: "Raleway", sans-serif}
    body, html {height: 100%; line-height: 1.8;}

    /* Full height image header */
    .bgimg-1 {
      background-position: center;
      background-size: cover;
      background-image: url("https://www.w3schools.com/w3images/mac.jpg");
      min-height: 100%;
    }

    .w3-bar .w3-button {padding: 16px;}
  </style>
</head>
<body>

<!-- Navbar -->
<div class="w3-top">
  <div class="w3-bar w3-white w3-card" id="myNavbar">
    <a href="#home" class="w3-bar-item w3-button w3-wide">
      <b>IP:</b> <%= content.ip %>
    </a>

    <div class="w3-right w3-hide-small">
      <a href="#icebreaker" class="w3-bar-item w3-button">Icebreaker</a>
      <a href="#you" class="w3-bar-item w3-button">You</a>
    </div>

    <a href="javascript:void(0)" class="w3-bar-item w3-button w3-right w3-hide-large w3-hide-medium" onclick="w3_open()">
      <i class="fa fa-bars"></i>
    </a>
  </div>
</div>

<!-- Sidebar for mobile -->
<nav class="w3-sidebar w3-bar-block w3-black w3-card w3-animate-left w3-hide-medium w3-hide-large" style="display:none" id="mySidebar">
  <a href="javascript:void(0)" onclick="w3_close()" class="w3-bar-item w3-button w3-large w3-padding-16">Close ×</a>
  <a href="#icebreaker" onclick="w3_close()" class="w3-bar-item w3-button">Icebreaker</a>
  <a href="#you" onclick="w3_close()" class="w3-bar-item w3-button">You</a>
</nav>

<!-- Header -->
<header class="bgimg-1 w3-display-container w3-grayscale-min" id="icebreaker">
  <div class="w3-display-left w3-text-white" style="padding:48px">
    <span class="w3-jumbo w3-hide-small">Icebreaker</span><br>
    <span class="w3-xxlarge w3-hide-large w3-hide-medium">Icebreaker</span><br>
    <span class="w3-large"><%= content.joke %></span>
    <p>
      <a href="/" class="w3-button w3-white w3-padding-large w3-large w3-margin-top w3-opacity w3-hover-opacity-off">Next</a>
    </p>
  </div>

  <div class="w3-display-bottomleft w3-text-grey w3-large" style="padding:24px 48px">
    <span class="w3-large">Icebreakers by Jokeapi.dev</span>
  </div>
</header>

<!-- Info Section -->
<div class="w3-container" id="you" style="padding:128px 16px">
  <div class="w3-row-padding w3-center">
    
    <!-- Vasen puoli: IP ja sijaintitiedot -->
    <div class="w3-col m6 w3-padding-large">
      <h3>Is it you?</h3>
      <p>
        <b>Your IP:</b> <%= content.ip %><br>
        <b>Location:</b> <%= content.city %>, <%= content.country %><br>
        <% if (content.lat && content.lon) { %>
          <b>Coordinates:</b> <%= content.lat %>, <%= content.lon %>
        <% } %>
      </p>

      <% if (content.lat && content.lon) { %>
        <!-- Google Maps -linkki uuteen välilehteen -->
        <p>
          <a href="https://www.google.com/maps?q=<%= content.lat %>,<%= content.lon %>"
             target="_blank"
             rel="noopener noreferrer"
             class="w3-button w3-black">
             <i class="fa fa-map-marker"></i> View on Google Maps
          </a>
        </p>
      <% } %>
    </div>

    <!-- Oikea puoli: upotettu kartta -->
    <div class="w3-col m6 w3-padding-large">
      <% if (content.lat && content.lon) { %>
        <iframe
          width="100%"
          height="400"
          style="border:0; border-radius:12px;"
          loading="lazy"
          allowfullscreen
          referrerpolicy="no-referrer-when-downgrade"
          src="https://www.google.com/maps?q=<%= content.lat %>,<%= content.lon %>&hl=en&z=10&output=embed">
        </iframe>
      <% } else { %>
        <p>No map data available for this IP.</p>
      <% } %>
    </div>
  </div>
</div>

<!-- uusi setti-->
<div class="w3-container" id="you" style="padding:128px 16px">
  <div class="w3-row-padding w3-center">

    <!-- Vasemman puolen sarake: Request data -->
    <div class="w3-col m6 w3-padding-large">
      <h3>Request data</h3>
      <p>Request data sent by browser:</p>
      <pre style="background:#111; color:#0f0; padding:16px; border-radius:8px; overflow:auto; text-align:left; font-size:14px;">
        <%= content.requestdataString %>
      </pre>
      <button class="w3-button w3-black w3-small" onclick="copyRequestData()">Copy request data</button>
    </div>

    <!-- Oikean puolen sarake: WHO.IS / IPWHO.IS -->
    <div class="w3-col m6 w3-padding-large">
      <h3>WHO.IS / IPWHO.IS data</h3>
      <p>All raw IP data returned from the API:</p>
      <pre style="background:#111; color:#0f0; padding:16px; border-radius:8px; overflow:auto; text-align:left; font-size:14px;">
        <%= content.ipdataString %>
      </pre>
      <button class="w3-button w3-black w3-small" onclick="copyJSON()">Copy JSON</button>
    </div>

  </div>
</div>

<!-- Statistics Section -->
<div class="w3-container w3-dark-grey w3-padding-64 w3-center">
  <div class="w3-row-padding">

    <!-- 1️⃣ Sivulataukset -->
    <div class="w3-third">
      <span class="w3-xxlarge"><%= content.loads %></span>
      <br>Pageloads
    </div>

    <!-- 2️⃣ Uniikit kävijät -->
    <div class="w3-third">
      <span class="w3-xxlarge"><%= content.uvisitors %></span>
      <br>Unique visitors
    </div>

    <!-- 3️⃣ Uniikit kaupungit + maat -->
    <div class="w3-third" style="text-align: left; max-height: 200px; overflow-y: auto;">
      <h4>Uniq city+country -combinations</h4>
      <ul style="margin:0; padding-left: 20px;">
        <% content.ulocations.forEach(loc => { %>
          <li><%= loc %></li>
        <% }); %>
      </ul>
    </div>

  </div>
</div>

<!-- Footer -->
<footer class="w3-center w3-black w3-padding-32">
  <p>© Häminen Productions</p>
  <p>
    <small>
    </small>
  </p>
</footer>

<script>
  var mySidebar = document.getElementById("mySidebar");

  function w3_open() {
    if (mySidebar.style.display === 'block') {
      mySidebar.style.display = 'none';
    } else {
      mySidebar.style.display = 'block';
    }
  }

  function w3_close() {
    mySidebar.style.display = "none";
  }


function copyRequestData() {
  navigator.clipboard.writeText(<%- content.requestdataString %>);
  alert("Request data copied to clipboard!");
}

function copyJSON() {
  navigator.clipboard.writeText(<%- content.ipdataString %>);
  alert("WHO.IS data copied to clipboard!");
}

</script>

</body>
</html>
